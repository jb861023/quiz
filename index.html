
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>線上作答網站</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    .question { margin-bottom: 20px; padding: 10px; border-bottom: 1px solid #ccc; }
    .options label { display: block; margin: 5px 0; }
    .result { font-weight: bold; margin-top: 20px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 20px; }
    .correct { color: green; }
    .incorrect { color: red; }
  </style>
</head>
<body>
  <h1>線上作答網站 - 每回 50 題 / 總分 100 分</h1>
  <form id="quizForm"></form>
  <button onclick="submitQuiz()">提交作答</button>
  <div class="result" id="result"></div>

  <script>
    // 題庫資料
    const fullQuestionBank = [
      { number: 1, text: "依據廢棄物清理法第 4 條的規定，廢棄物清理法的主管機關在直轄市為：", options: ["市政府", "環保局", "區公所", "民政局"], answer: 1 },
      { number: 2, text: "火災或其他災變發生後經所有人拋棄遺留現場者，由誰來負責清除？", options: ["建築物所有人或管理人", "環保局", "警察局", "市政府"], answer: 1 }
      // ...你可在這裡繼續加入更多題目...
    ];

    const QUESTIONS_PER_SESSION = 50;
    const POINTS_PER_QUESTION = 2;

    const usedQuestionsKey = 'usedQuestions';
    let usedQuestions = JSON.parse(localStorage.getItem(usedQuestionsKey) || '[]');

    function getNewQuestions() {
      const remaining = fullQuestionBank.filter(q => !usedQuestions.includes(q.number));
      let selected = [];
      if (remaining.length >= QUESTIONS_PER_SESSION) {
        selected = shuffleArray(remaining).slice(0, QUESTIONS_PER_SESSION);
      } else {
        selected = [...remaining];
        const needed = QUESTIONS_PER_SESSION - selected.length;
        const unused = shuffleArray(fullQuestionBank).slice(0, needed);
        selected = selected.concat(unused);
        usedQuestions = []; // reset
      }
      usedQuestions.push(...selected.map(q => q.number));
      localStorage.setItem(usedQuestionsKey, JSON.stringify([...new Set(usedQuestions)]));
      return selected;
    }

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    const questions = getNewQuestions();
    const form = document.getElementById("quizForm");

    questions.forEach((q, index) => {
      const qDiv = document.createElement("div");
      qDiv.className = "question";
      qDiv.innerHTML = `<p><strong>第 ${index + 1} 題：</strong>${q.text}</p>` +
        q.options.map((opt, i) => `
          <label><input type="radio" name="q${index}" value="${i + 1}"> (${i + 1}) ${opt}</label>
        `).join("");
      form.appendChild(qDiv);
    });

    function submitQuiz() {
      let score = 0;
      let feedback = "";
      questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name='q${index}']:checked`);
        const userAnswer = selected ? parseInt(selected.value) : null;
        const correct = q.answer === userAnswer;
        if (correct) score += POINTS_PER_QUESTION;
        feedback += `<p>第 ${index + 1} 題：${correct ? '<span class="correct">答對</span>' : `<span class="incorrect">答錯，正確答案是 (${q.answer}) ${q.options[q.answer - 1]}`}</span></p>`;
      });
      document.getElementById("result").innerHTML = `<h2>總分：${score} / 100</h2>` + feedback;
      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>
</html>
